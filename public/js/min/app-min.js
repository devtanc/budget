angular.module("budgetApp",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"/temps/frontPage.temp.html",controller:"FrontPageController"})}]);var budgetApp=angular.module("budgetApp");budgetApp.controller("FrontPageController",["$scope","$location","couchReq",function(a,b,c){function d(a,b,c,d,e){if(a){if(b>c.getDate()&&b<d.getDate())return!0}else if("undefined"==typeof e){if(b>c.getDate()&&b<c.getDays()||b<d.getDate())return!0}else{var f=new Date(c.getFullYear(),c.getMonth(),b).getDay(),g=new Date(d.getFullYear(),d.getMonth(),b).getDay();if(b>c.getDate()&&b<c.getDays()&&e==f||b<d.getDate()&&e==g)return!0}return!1}function e(){var b=new Date,c=new Date(a.storedPayPeriod.lastPayPeriodStart),d=new Date(a.storedPayPeriod.lastPayPeriodEnd),e=new Date(d.valueOf()+g);b.valueOf()<e.valueOf()?a.paycheckDate=c:a.paycheckDate=e,a.calculate()}var f=12096e5,g=864e5,h={};a.expenses=[],a.netPay=950.03,a.total=0,a.goTo=function(a){b.path(a)},c.get({view:"recurrence"}).then(function(b){b.map(function(a){h[a.key]||(h[a.key]=[]),h[a.key].push(a.value)}),c.get({view:"lastPayPeriod"}).then(function(b){console.log(b),b.length&&(b=b[0].value,a.storedPayPeriod=b,e())})}),a.calculate=function(){a.expenses=[],a.total=0;var b=new Date(a.paycheckDate),e=new Date(b.valueOf()+f-g),i=b.getMonth()===e.getMonth()?!0:!1;a.storedPayPeriod?(a.storedPayPeriod.lastPayPeriodStart=b.toISOString(),a.storedPayPeriod.lastPayPeriodEnd=e.toISOString(),c.update(a.storedPayPeriod).then(function(b){a.storedPayPeriod._rev=b.rev})):(a.storedPayPeriod={},a.storedPayPeriod.lastPayPeriodEnd=e.toISOString(),a.storedPayPeriod.lastPayPeriodStart=b.toISOString(),c.add({lastPayPeriodStart:a.storedPayPeriod.lastPayPeriodStart,lastPayPeriodEnd:a.storedPayPeriod.lastPayPeriodEnd}).then(function(b){console.log(b),a.storedPayPeriod._id=b.id,a.storedPayPeriod._rev=b.rev})),h.hasOwnProperty("paycheck")&&h.paycheck.forEach(function(c){c.day_of_month=b.getDate(),"Allowance"==c.purpose&&(c.day_of_month=new Date(b.getFullYear(),b.getMonth(),b.getDate()+4).getDate()),a.expenses.push(c)}),h.hasOwnProperty("monthly")&&h.monthly.forEach(function(c){d(i,c.day_of_month,b,e)&&a.expenses.push(c)}),h.hasOwnProperty("monthly-on")&&h["monthly-on"].forEach(function(c){for(var f=0,g=1;g<=b.getDays();g++){var h=new Date(b.getFullYear(),b.getMonth(),g);if(h.getDay()==c.numerical_day_of_week&&(f++,f==c.which&&d(i,h.getDate(),b,e,c.numerical_day_of_week)))return c.day_of_month=h.getDate(),void a.expenses.push(c)}if(!i)for(var f=0,g=1;g<=e.getDays();g++){var h=new Date(e.getFullYear(),e.getMonth(),g);if(h.getDay()==c.numerical_day_of_week&&(f++,f==c.which&&d(i,h.getDate(),b,e,c.numerical_day_of_week)))return c.day_of_month=h.getDate(),void a.expenses.push(c)}}),h.hasOwnProperty("yearly")&&h.yearly.forEach(function(c){(b.getMonth()===c.numerical_month||e.getMonth()===c.numerical_month)&&d(i,c.day_of_month,b,e)&&a.expenses.push(c)}),h.hasOwnProperty("one-off")&&h["one-off"].forEach(function(c){var d=new Date(c.date);b.valueOf()<d.valueOf()&&d.valueOf()<e.valueOf()&&a.expenses.push(c)}),a.expenses.forEach(function(b){a.total+=b.amount})}}]);var budgetApp=angular.module("budgetApp"),budgetApp=angular.module("budgetApp");budgetApp.service("couchReq",["$http",function(a){this.get=function(b){return a({url:"/api/get",method:"POST",data:b,headers:{"Content-Type":"application/json"}}).then(function(a){return a.data.rows},function(a){console.log(a)})},this["delete"]=function(b,c){return a({url:"/api",method:"DELETE",data:{_id:b,_rev:c},headers:{"Content-Type":"application/json"}}).then(function(a){console.log("DELETED: "+a.data)},function(a){console.log(a)})},this.add=function(b){return a({url:"/api",method:"POST",data:b,headers:{"Content-Type":"application/json"}}).then(function(a){return console.log("POST NEW SUCCESSFUL: "+a),a.data},function(a){console.log(a)})},this.update=function(b){return b.hasOwnProperty("$$hashKey")&&delete b.$$hashKey,a({url:"/api",method:"PUT",data:b,headers:{"Content-Type":"application/json"}}).then(function(a){return console.log("PUT SUCCESSFUL: "+a),a.data},function(a){console.log(a)})},this.parseTimestamps=function(a){return a.forEach(function(a){if(a.value.timestamp){var b=new Date(a.value.timestamp);a.value.timestamp=b.toLocaleDateString()}}),a}}]);