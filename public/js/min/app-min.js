angular.module("budgetApp",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"/temps/frontPage.temp.html",controller:"FrontPageController"})}]);var budgetApp=angular.module("budgetApp");budgetApp.controller("FrontPageController",["$scope","$location","couchReq",function(a,b,c){function d(a,b,c,d,e){if(a){if(b>c.getDate()&&b<d.getDate())return!0}else if("undefined"==typeof e){if(b>c.getDate()&&b<c.getDays()||b<d.getDate())return!0}else{var f=new Date(c.getFullYear(),c.getMonth(),b).getDay(),g=new Date(d.getFullYear(),d.getMonth(),b).getDay();if(b>c.getDate()&&b<c.getDays()&&e==f||b<d.getDate()&&e==g)return!0}return!1}var e=12096e5,f=864e5,g={};a.expenses=[],a.netPay=950.03,a.total=0,a.goTo=function(a){b.path(a)},c.get({view:"recurrence"}).then(function(b){b.map(function(a){g[a.key]||(g[a.key]=[]),g[a.key].push(a.value)}),c.get({view:"lastPayPeriod"}).then(function(b){console.log(b),b.length&&(b=b[0].value,a.storedPayPeriod=b,a.paycheckDate=new Date(a.storedPayPeriod.lastPayPeriodStart),a.calculate())})}),a.calculate=function(){a.expenses=[],a.total=0;var b=new Date(a.paycheckDate),h=new Date(b.valueOf()+e-f),i=b.getMonth()===h.getMonth()?!0:!1;a.storedPayPeriod||(a.storedPayPeriod={},a.storedPayPeriod.lastPayPeriodEnd=h.toISOString(),a.storedPayPeriod.lastPayPeriodStart=b.toISOString(),c.add({lastPayPeriodStart:a.storedPayPeriod.lastPayPeriodStart,lastPayPeriodEnd:a.storedPayPeriod.lastPayPeriodEnd}).then(function(b){console.log(b),a.storedPayPeriod._id=b.id,a.storedPayPeriod._rev=b.rev})),g.hasOwnProperty("paycheck")&&g.paycheck.forEach(function(c){c.day_of_month=b.getDate(),"Allowance"==c.purpose&&(c.day_of_month=new Date(b.getFullYear(),b.getMonth(),b.getDate()+4).getDate()),a.expenses.push(c)}),g.hasOwnProperty("monthly")&&g.monthly.forEach(function(c){d(i,c.day_of_month,b,h)&&a.expenses.push(c)}),g.hasOwnProperty("monthly-on")&&g["monthly-on"].forEach(function(c){for(var e=0,f=1;f<=b.getDays();f++){var g=new Date(b.getFullYear(),b.getMonth(),f);if(g.getDay()==c.numerical_day_of_week&&(e++,e==c.which&&d(i,g.getDate(),b,h,c.numerical_day_of_week)))return c.day_of_month=g.getDate(),void a.expenses.push(c)}if(!i)for(var e=0,f=1;f<=h.getDays();f++){var g=new Date(h.getFullYear(),h.getMonth(),f);if(g.getDay()==c.numerical_day_of_week&&(e++,e==c.which&&d(i,g.getDate(),b,h,c.numerical_day_of_week)))return c.day_of_month=g.getDate(),void a.expenses.push(c)}}),g.hasOwnProperty("yearly")&&g.yearly.forEach(function(c){(b.getMonth()===c.numerical_month||h.getMonth()===c.numerical_month)&&d(i,c.day_of_month,b,h)&&a.expenses.push(c)}),g.hasOwnProperty("one-off")&&g["one-off"].forEach(function(c){var d=new Date(c.date);b.valueOf()<d.valueOf()&&d.valueOf()<h.valueOf()&&(c.day_of_month=d.getDate(),a.expenses.push(c))}),a.expenses.forEach(function(b){a.total+=b.amount})}}]);var budgetApp=angular.module("budgetApp"),budgetApp=angular.module("budgetApp");budgetApp.service("couchReq",["$http",function(a){this.get=function(b){return a({url:"/api/get",method:"POST",data:b,headers:{"Content-Type":"application/json"}}).then(function(a){return a.data.rows},function(a){console.log(a)})},this["delete"]=function(b,c){return a({url:"/api",method:"DELETE",data:{_id:b,_rev:c},headers:{"Content-Type":"application/json"}}).then(function(a){console.log("DELETED: "+a.data)},function(a){console.log(a)})},this.add=function(b){return a({url:"/api",method:"POST",data:b,headers:{"Content-Type":"application/json"}}).then(function(a){return console.log("POST NEW SUCCESSFUL: "+a),a.data},function(a){console.log(a)})},this.update=function(b){return b.hasOwnProperty("$$hashKey")&&delete b.$$hashKey,a({url:"/api",method:"PUT",data:b,headers:{"Content-Type":"application/json"}}).then(function(a){return console.log("PUT SUCCESSFUL: "+a),a.data},function(a){console.log(a)})},this.parseTimestamps=function(a){return a.forEach(function(a){if(a.value.timestamp){var b=new Date(a.value.timestamp);a.value.timestamp=b.toLocaleDateString()}}),a}}]);